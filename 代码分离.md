



# 前端代码分离

## 现状

前端源码和编译后代码同在一个Git仓库，每次修改一处需要提交多个文件，甚至是没有改动的文件也需要重新提交Git仓库。

## 问题

 1.  编译代码在版本库中导致每次git提交很多修改
 2. static、web目录会越来越大
 2.  前、后端代码在一起，每次全部上线包括后端代码，容易引起问题

## 分离目标

- **前端代码和后端代码分离，独立的Git仓库**
- **前端源码和编译后代码分离，Git仓库只维护源码**

## 分离方案
 
下面会从子系统的创建、前端开发、和后端链条、QA提测、以及发布上线完整开发流程详细说明分离方案的实施步骤。

### 子系统初始化

 1.  CP平台提供前端子系统仓库初始化功能 (前期可以手工维护前端子系统列表，CP平台上线时使用)

### 前端开发

假设负责维护PC 用户子系统的同学一个典型的开发流程应该是：

 1.  下载PC的user子系统，并创建分支
		
    git clone git@git.icarsclub.git:icarsclub/fe/pc/user.git 
    git branch user_bugfix
		
 1.  本地或者开发机开发代码
 1.  发布到测试环境 
		fis release -d (local | wangcheng_test38) -w
 1.  提交user_bugfix分支
		
### 后端联调

联调过程和目前类似

 1.  开发机更新运行时环境，后端代码
 1.  编译、部署user代码，链条查看效果

### QA提测

 1. 分支提测给QA
 2. 子系统提供build_qa.sh脚本，自动编译、部署代码到QA机器的运行时环境

### 上线发布

 1.  子系统分支合并、提交远端
 1.  CP平台选择 Fe->Pc-> *** 子系统上线  
 
 上线详细流程如图：
	 
	 ![enter image description here](https://lh4.googleusercontent.com/-Y4zyUx0Cmy4/VNGPQyLHxAI/AAAAAAAAAF4/DqFK9t57mcQ/s0/cp-build.png "cp-build.png")

## 需要的工作

### 编译机工作

1.  编译环境准备(Fis环境、编译账户)  

### CP平台开发工作

或者独立一个前端上线平台，但最好能够Cp平台提供，统一管理。无论是前端、后端子系统拆分独立上线都是迟早要进行的事，后续后端肯定也会需要类似的子系统独立编译上线平台。

 1.  产品(子系统)选择上线功能
 2.  子系统编译、上线部署功能
 3.  新建子系统功能、初始化Git仓库(维护子系统对应仓库列表)  -- 前期迁移此项功能非必须
  
### 项目迁移工作

 1. 子系统拆分工作
 2. Git仓库建立、源码迁移(Git历史能否迁移)
 3. 子系统编译脚本build.sh、QA编译脚本build_qa.sh

### 沟通

>  和后端研发、QA等沟通确认新的前端开发合作模式