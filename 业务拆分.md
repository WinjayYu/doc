


## 业务拆分

### 为什么要拆分

 -  共同使用一个模块，导致合并风险较大，项目依赖比较严重
 -  每次需要整站编译上线

### 拆分目标

 -  子系统独立编译、上线不依赖其他模块，避免整站上线较大的回归成本和风险
 -  减少代码间的合并冲突几率

### 站点结构

**站点（site）** ：一般指能独立提供服务，产品线。比如PP租车pc版、PP租车mo版等。

**子系统（module）**：具有较清晰业务逻辑关系的功能业务集合。多个子系统构成一个站点。比如用户子系统、租车子系统、车辆详情页子系统等。

**页面（page）**：具有独立URL的输出内容，多个页面一般可组成子系统。比如用户系统首页。

**组件（widget）**：能独立提供交互的页面元素区域，俗称页面碎片，包含对应的css以及js。一般多个组件构成一个完整的页面。比如用户首页中的个人名片信息组件。


### 子系统划分

####  子系统划分原则

**子系统划分的首要原则就是：在子系统完全独立的情况下(功能独立不依赖其他子系统)，尽可能小的拆分**

	子系统独立编译、上线避免整站上线
	根据之前经验一个类似与百度旅游、百度云相册中等规则产品线通常会拆分5-8个子系统，百度知道、百度百科等大型产品会拆分10+个子系统，百度贴吧这种超大型产品会有接近20+个子系统。

**一个子系统对应于一个独立的Git分支；**	

	减少代码的合并次数以及合并成本

**子系统命名**
	
> 通用子系统，Git分支命名规定为 common；其他业务子系统命名与后端RD一起商定，一般与业务提供的服务对应的URL的根目录命名保持一致，比如 /user/xxx 相关的业务，一般存放为 user，/car/xxx 相关业务命名为car模块

#### 子系统间的关系

> 为了复用需要，要把各子系统间“通用”部分代码，抽象到“通用子系统”中，它是虚拟的业务子系统。一般来说，站点可以由一个通用子系统+多个业务子系统构成。通用子系统的资源是公共的，业务子系统的资源为私有的。子系统资源依赖关系如下：

> 业务子系统内部的代码可存在编译和运行时的资源依懒；
业务子系统只对“通用子系统”存在运行时的公共资源依懒；
不同业务子系统之间不能存在编译和运行时的资源依懒。

#### 通用子系统详述

 - 当有两个或者两个以上模块的用到一个类似功能的时候，就把它放到common子系统里 

通用子系统(Common)通常包含一下内容：

page-通用页面

> 从业务开发来看，有些交互模式有约定俗成的，比如ajax/jsonp，我们可以用固定的数据格式，统一前后端进行交互。RD&FE可以对这些页面有特殊的处理逻辑，比如输出特定的HTTP头。通用页面包括但不限于：

    ajax.php: Ajax交互的数据
    json.php: FE不好控制的交互格式，需要特殊数据格式的输出的场景，如Flash组件与后端交互时数据返回
    jsonp.php: js callback机制的数据返回(一般用于跨域或者GBK的异步调用场景)
    xml.php: 需要输出XML数据的情形
    layout.php 站点的通用页面布局方案
    
widget-通用模板组件

> 通用模板组件是指站点级别复用的组件，多个（>=2）业务子系统需要共享的组件代码和资源，如全站统一的页头和页尾。对于站点早期设计时，能够区分的，可以直接存放到这里。对于不能确定或没有多个子系统复用需求的组件，先由该业务子系统自行维护，当发现有多子系统复用需求时，由合适的工程师对组件进行重构和封装，存放到通用子系统中，并修改原先调用路径。 通用组件一般来说，都有一定的站点逻辑特征，但大部分情况下，它是与具体业务子系统的业务数据没有直接关联（很特殊的情况下，为了跨子系统复用，产品线也可以考虑将有子业务系统特征的代码维护）。


### 拆分工作

 -  按照业务拆分子系统

> 模块拆分结果、各个模块的主要负责人

 -  子系统Git仓库迁移

> 排除非common依赖
> 独立维护fis-conf.js和build.sh脚本

 -  ICT运行时框架升级支持
 


